#!/usr/bin/env ruby
require 'rubygems'
require 'cmdparse'

PMVC_GEN_LIB = File.join(File.dirname(__FILE__), '..', 'lib', 'pure_m_v_c_gen')
require File.join(PMVC_GEN_LIB, 'ant_checker')

unless PureMVCGen::AntChecker.has_ant_installed?
  err = <<-EOL
    You must have ANT installed to run puremvc-gen.
    Install it! ==> http://ant.apache.org
    If you have it installed, ensure it is on your path.
  EOL
  puts err
  exit 1
end

CMD_PATH = File.join(PMVC_GEN_LIB, 'commands')

require File.join(CMD_PATH, 'command_extensions')
require File.join(CMD_PATH, 'check_command')
require File.join(CMD_PATH, 'initialize_command')
require File.join(CMD_PATH, 'new_command')

include PureMVCGen::Commands

PMVC_GEN_HOME = File.join(File.dirname(__FILE__), '..', 'conf')
BUILDFILE = File.join(PMVC_GEN_HOME, 'build.xml')

def call_ant(args='')
  system "ant -f #{BUILDFILE} -Dpmvcgen.dir=#{PMVC_GEN_HOME} -Dbasedir=#{Dir.pwd} #{args}"
end

cmd = CmdParse::CommandParser.new(true, true)
cmd.program_name    = "puremvc-gen "
cmd.program_version = [0, 0, 1]

cmd.add_command(CmdParse::HelpCommand.new)
cmd.add_command(CmdParse::VersionCommand.new)

cmd.add_command(CheckCommand.new)
cmd.add_command(InitializeCommand.new)
cmd.add_command(NewCommand.new)

cmd.parse
